---
phase: 06-tests-ci
plan: 04
type: execute
depends_on: ["06-03"]
files_modified: [tests/test_integration.py]
domain: python
---

<objective>
Create comprehensive integration tests for end-to-end workflows.

Purpose: Test full pipelines work correctly: episode generation → experiment execution → analysis. Verify components work together correctly and produce expected outputs. These tests ensure the system works end-to-end.

Output: Integration test file covering full workflows and component interactions.
</objective>

<execution_context>
~/.cursor/get-shit-done/workflows/execute-plan.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-tests-ci/06-03-SUMMARY.md
@src/bsa/experiments/run_experiment.py
@src/bsa/cli.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create integration tests</name>
  <files>tests/test_integration.py</files>
  <action>
    Create `tests/test_integration.py` with comprehensive integration tests:
    
    1. **Episode Generation → Experiment Integration**:
       - `test_generate_and_run_experiment()`: Test full workflow from episode generation to experiment execution
       - `test_episode_compatibility()`: Test episodes work with experiment runner
       - `test_multiple_episodes_experiment()`: Test running experiments on multiple episodes
    
    2. **Experiment → Analysis Integration**:
       - `test_experiment_to_analysis()`: Test full workflow from experiment execution to analysis
       - `test_metrics_to_plots()`: Test metrics can be plotted
       - `test_metrics_to_tables()`: Test metrics can be tabulated
       - `test_metrics_to_report()`: Test metrics can be reported
    
    3. **Full Pipeline Integration**:
       - `test_full_pipeline()`: Test complete pipeline: generate → run → analyze
       - `test_reproduce_function()`: Test reproduce() function works end-to-end
       - `test_cli_commands()`: Test CLI commands work correctly
       - `test_make_reproduce()`: Test make reproduce target works
    
    4. **Component Integration**:
       - `test_helper_agents_with_environments()`: Test helper agents work with both GridHouse and VirtualHome
       - `test_particle_filter_with_helper()`: Test particle filter integration with BeliefSensitiveHelper
       - `test_evaluator_with_all_agents()`: Test evaluator works with all helper agent types
    
    5. **Error Handling Integration**:
       - `test_missing_files()`: Test graceful handling of missing files
       - `test_invalid_configs()`: Test graceful handling of invalid configs
       - `test_partial_failures()`: Test system handles partial failures gracefully
    
    6. Use pytest fixtures for:
       - Temporary directories for outputs
       - Sample configs
       - Sample environments
    
    7. Use temporary directories for all outputs.
    8. Ensure tests are deterministic (use seeds).
  </action>
  <verify>
    Run `pytest tests/test_integration.py -v` - should run all tests successfully.
    Run `pytest tests/test_integration.py::test_full_pipeline -v` - should test full pipeline.
  </verify>
  <done>Integration tests implemented, covering full workflows and component interactions</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] Integration tests pass
- [ ] Full pipeline test works
- [ ] Component integration tests pass
- [ ] Error handling tests pass
- [ ] Tests use temporary directories
- [ ] Tests are deterministic
</verification>

<success_criteria>

- Comprehensive integration tests for end-to-end workflows
- Tests verify full pipeline works correctly
- Ready for Plan 06-05 (CI workflow completion)
  </success_criteria>

<output>
After completion, create `.planning/phases/06-tests-ci/06-04-SUMMARY.md`:

# Phase 6 Plan 4: Integration Tests Summary

**Implemented comprehensive integration tests**

## Accomplishments

- Created integration tests for full workflows
- Created tests for component interactions
- Created tests for error handling
- Tests verify end-to-end functionality

## Files Created/Modified

- `tests/test_integration.py` - Integration tests

## Decisions Made

- Test scope: Full pipeline and component interactions
- Error handling: Test graceful failure handling
- Temporary directories: Use for all test outputs
- Deterministic testing: Use fixed seeds

## Issues Encountered

[Any issues with integration testing, pipeline failures, etc.]

## Next Step

Ready for 06-05-PLAN.md (CI workflow completion)
</output>
