---
phase: 05-metrics-analysis-report
plan: 05
type: execute
depends_on: ["05-04"]
files_modified: [src/bsa/analysis/aggregate.py, src/bsa/cli.py, Makefile]
domain: python
---

<objective>
Complete analysis pipeline integration and ensure CLI analyze command works end-to-end.

Purpose: Integrate all analysis components (aggregation, plotting, tables, report) into a complete pipeline. Ensure `bsa analyze` command works correctly and `make reproduce` produces complete results including figures and report. This completes Phase 5.

Output: Complete analysis pipeline working end-to-end, CLI integration complete, reproduction pipeline produces full results.
</objective>

<execution_context>
~/.cursor/get-shit-done/workflows/execute-plan.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-metrics-analysis-report/05-04-SUMMARY.md
@src/bsa/analysis/aggregate.py
@src/bsa/cli.py
@Makefile
</context>

<tasks>

<task type="auto">
  <name>Task 1: Complete analyze_results() function</name>
  <files>src/bsa/analysis/aggregate.py</files>
  <action>
    Complete `analyze_results()` function in `src/bsa/analysis/aggregate.py` to:
    
    1. Load config from `configs/analysis/plots.yaml`
    2. Run full analysis pipeline:
       - Load and aggregate results
       - Generate plots (using PlotGenerator)
       - Generate tables (using TableGenerator)
       - Generate report (using ReportGenerator)
    3. Save all outputs:
       - Aggregated results to `results/metrics/aggregated/`
       - Plots to `results/figures/`
       - Tables to `results/tables/`
       - Report to `results/reports/report.md`
    4. Print progress and completion message
    5. Return summary of generated artifacts
    
    This function is called by `bsa analyze` command.
    
    Ensure it handles errors gracefully and provides clear progress output.
  </action>
  <verify>
    Run `python -m src.bsa.cli analyze --config configs/analysis/plots.yaml --input results/metrics` - should run full analysis pipeline successfully.
    Check that figures, tables, and report are generated.
  </verify>
  <done>analyze_results() function complete, full pipeline works</done>
</task>

<task type="auto">
  <name>Task 2: Update reproduce() to include analysis</name>
  <files>src/bsa/experiments/run_experiment.py</files>
  <action>
    Update `reproduce()` function to include analysis step:
    
    1. After running experiments, call `analyze_results()`
    2. Ensure analysis uses results from the experiment run
    3. Update progress messages to include analysis step
    4. Ensure all artifacts (figures, tables, report) are generated
    
    This completes the full reproduction pipeline: generate → run → analyze.
    
    Ensure analysis step is optional/configurable (can be skipped if needed).
  </action>
  <verify>
    Run `python -m src.bsa.cli reproduce --small` - should run full pipeline including analysis.
    Check that report is generated at `results/reports/report.md`.
  </verify>
  <done>reproduce() function includes analysis, full pipeline works</done>
</task>

<task type="auto">
  <name>Task 3: Verify Makefile targets</name>
  <files>Makefile</files>
  <action>
    Verify and update Makefile targets:
    
    1. `analyze` target: Should call `bsa analyze` with correct config
    2. `reproduce` target: Should run full pipeline (generate → run → analyze)
    3. Ensure targets work correctly
    
    Update if needed to ensure `make reproduce` produces complete results.
  </action>
  <verify>
    Run `make analyze` - should run analysis successfully.
    Run `make reproduce` - should run full pipeline and produce report.
  </verify>
  <done>Makefile targets work correctly</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] analyze_results() function complete and working
- [ ] Full analysis pipeline works (aggregate → plots → tables → report)
- [ ] CLI analyze command works
- [ ] reproduce() function includes analysis
- [ ] Makefile targets work
- [ ] Full reproduction produces figures and report
</verification>

<success_criteria>

- Full analysis pipeline implemented and working
- CLI analyze command complete
- Reproduction pipeline produces complete results (figures, tables, report)
- Phase 5 complete - Metrics + Analysis + Report ready
  </success_criteria>

<output>
After completion, create `.planning/phases/05-metrics-analysis-report/05-05-SUMMARY.md`:

# Phase 5 Plan 5: Integration and CLI Completion Summary

**Completed analysis pipeline integration**

## Accomplishments

- Completed analyze_results() function with full pipeline
- Integrated aggregation, plotting, tables, and report generation
- Updated reproduce() to include analysis
- Makefile targets working

## Files Created/Modified

- `src/bsa/analysis/aggregate.py` - Completed analyze_results() function
- `src/bsa/experiments/run_experiment.py` - Updated reproduce() to include analysis
- `Makefile` - Verified targets work

## Decisions Made

- Analysis pipeline: aggregate → plots → tables → report
- Integration approach: Single analyze_results() function orchestrates all steps
- Output organization: Separate directories for figures, tables, reports

## Issues Encountered

[Any issues with pipeline integration, CLI, etc.]

## Next Step

**Phase 5 complete!** Ready for Phase 6 (Tests + CI) or production use.
</output>
