---
phase: 05-metrics-analysis-report
plan: 04
type: execute
depends_on: ["05-03"]
files_modified: [src/bsa/analysis/report.py, src/bsa/analysis/__init__.py, paper/report_template.md]
domain: python
---

<objective>
Create technical report generation module that produces comprehensive research report.

Purpose: Generate a detailed technical report from experiment results, including methodology, results, figures, tables, and conclusions. The report should be markdown-based, include all plots and tables, and be suitable for publication or documentation. This completes the analysis pipeline.

Output: ReportGenerator class that generates comprehensive technical report from templates and results.
</objective>

<execution_context>
~/.cursor/get-shit-done/workflows/execute-plan.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-metrics-analysis-report/05-03-SUMMARY.md
@src/bsa/analysis/aggregate.py
@src/bsa/viz/plots.py
@src/bsa/analysis/tables.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create report template</name>
  <files>paper/report_template.md</files>
  <action>
    Create `paper/report_template.md` with report template structure:
    
    1. Title and abstract section
    2. Introduction section (with placeholders)
    3. Methodology section:
       - Task descriptions
       - Helper agent descriptions
       - Evaluation metrics
       - Experimental setup
    
    4. Results section with placeholders for:
       - Summary statistics
       - Figures (with placeholders for plot paths)
       - Tables (with placeholders for table paths)
       - Model comparisons
       - Ablation studies
    
    5. Discussion section (with placeholders)
    6. Conclusion section (with placeholders)
    7. Appendix section:
       - Experimental details
       - Hyperparameters
       - Reproducibility information
    
    Use markdown format with placeholders like `{{SUMMARY_STATS}}`, `{{FIGURES}}`, `{{TABLES}}`, etc.
    
    This template will be filled in by ReportGenerator.
  </action>
  <verify>
    Run `python -c "from pathlib import Path; template = Path('paper/report_template.md'); print('Template exists:', template.exists())"` - should exist.
    Check template has placeholders for dynamic content.
  </verify>
  <done>Report template created with all required sections</done>
</task>

<task type="auto">
  <name>Task 2: Create ReportGenerator class</name>
  <files>src/bsa/analysis/report.py, src/bsa/analysis/__init__.py</files>
  <action>
    Create `src/bsa/analysis/report.py` with `ReportGenerator` class that:
    
    1. Initializes with:
       - Aggregated results DataFrame
       - Summary statistics dictionary
       - Paths to generated figures and tables
       - Template path
       - Output path
    
    2. Implements `generate_report()` method that:
       - Loads report template
       - Fills in placeholders:
         - Summary statistics
         - Figure references (markdown image links)
         - Table references (markdown table includes or LaTeX)
         - Model comparison text
         - Ablation study results
       - Saves generated report to output path
    
    3. Implements `_fill_summary_section()` method:
       - Generates summary statistics text
       - Highlights key findings
       - Compares models
    
    4. Implements `_fill_results_section()` method:
       - Inserts figure references
       - Inserts table references
       - Adds captions and descriptions
    
    5. Implements `_fill_discussion_section()` method:
       - Generates discussion text based on results
       - Highlights significant findings
       - Discusses implications
    
    6. Handles template placeholders:
       - Replaces `{{PLACEHOLDER}}` with actual content
       - Handles missing data gracefully
       - Preserves template structure
    
    Export `ReportGenerator` from `src/bsa/analysis/__init__.py`.
    
    Ensure report is well-formatted and includes all results.
  </action>
  <verify>
    Run `python -c "from src.bsa.analysis import ReportGenerator; print('Import OK')"` - should import successfully.
    Run `python -c "from src.bsa.analysis.report import ReportGenerator; import pandas as pd; df = pd.read_parquet('results/metrics/main_experiment/results.parquet'); gen = ReportGenerator(df, {}, [], [], 'paper/report_template.md', 'results/reports/report.md'); print('ReportGenerator created')"` - should create generator without errors.
  </verify>
  <done>ReportGenerator exists, can generate reports from templates</done>
</task>

<task type="auto">
  <name>Task 3: Implement generate_report() function</name>
  <files>src/bsa/analysis/report.py</files>
  <action>
    Implement `generate_report()` function (called by analysis pipeline) that:
    
    1. Takes config dictionary
    2. Loads aggregated results
    3. Generates summary statistics
    4. Collects paths to generated figures and tables
    5. Creates ReportGenerator instance
    6. Generates report
    7. Saves to output path (from config or default `results/reports/report.md`)
    8. Returns path to generated report
    
    This function is called by `bsa analyze` command.
    
    Ensure it integrates with the full analysis pipeline (aggregate → plots → tables → report).
  </action>
  <verify>
    Run `python -c "from src.bsa.analysis.report import generate_report; from src.bsa.common.config import load_config; from pathlib import Path; config = load_config(Path('configs/analysis/plots.yaml')); generate_report(config)"` - should generate report (may need aggregated results and plots/tables first).
  </verify>
  <done>generate_report() function implemented, integrates with analysis pipeline</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] Report template exists with all required sections
- [ ] ReportGenerator can generate reports from templates
- [ ] Report includes all results (figures, tables, statistics)
- [ ] Report is well-formatted and readable
- [ ] generate_report() function works with config
- [ ] Report saved correctly to results/reports/
</verification>

<success_criteria>

- ReportGenerator implemented and working
- Technical report generated successfully
- Report includes all results and analysis
- Ready for Plan 05-05 (Integration and CLI completion)
  </success_criteria>

<output>
After completion, create `.planning/phases/05-metrics-analysis-report/05-04-SUMMARY.md`:

# Phase 5 Plan 4: Report Generation Summary

**Implemented technical report generation module**

## Accomplishments

- Created report template with all required sections
- Created ReportGenerator class
- Generates comprehensive technical reports
- Includes all results (figures, tables, statistics)

## Files Created/Modified

- `paper/report_template.md` - Report template
- `src/bsa/analysis/report.py` - ReportGenerator class
- `src/bsa/analysis/__init__.py` - Export ReportGenerator

## Decisions Made

- Report format: Markdown (can be converted to PDF/HTML)
- Template approach: Placeholder-based template filling
- Report structure: Title, Abstract, Introduction, Methodology, Results, Discussion, Conclusion, Appendix
- Figure/table inclusion: Markdown image links and table includes

## Issues Encountered

[Any issues with template filling, report formatting, etc.]

## Next Step

Ready for 05-05-PLAN.md (Integration and CLI completion)
</output>
