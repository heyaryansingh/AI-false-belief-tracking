---
phase: 05-metrics-analysis-report
plan: 02
type: execute
depends_on: ["05-01"]
files_modified: [src/bsa/viz/plots.py, src/bsa/viz/__init__.py, configs/analysis/plots.yaml]
domain: python
---

<objective>
Create plotting module for generating visualizations from experiment results.

Purpose: Generate publication-quality plots including timelines, histograms, ablation curves, and comparison charts. Plots should be configurable, reproducible, and save to results/figures/. This enables visual analysis of experiment results.

Output: PlotGenerator class with methods for different plot types, integration with analysis config.
</objective>

<execution_context>
~/.cursor/get-shit-done/workflows/execute-plan.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-metrics-analysis-report/05-01-SUMMARY.md
@src/bsa/analysis/aggregate.py
@configs/analysis/plots.yaml
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create PlotGenerator class</name>
  <files>src/bsa/viz/plots.py, src/bsa/viz/__init__.py</files>
  <action>
    Create `src/bsa/viz/plots.py` with `PlotGenerator` class that:
    
    1. Initializes with aggregated results DataFrame and output directory
    
    2. Implements `plot_belief_timeline()` method:
       - Plots belief state over time for an episode
       - Shows goal distribution evolution
       - Shows object location beliefs vs. true locations
       - Saves to `belief_timeline.png`
    
    3. Implements `plot_detection_auroc()` method:
       - Plots AUROC comparison across models
       - Bar chart or box plot showing AUROC for each model
       - Error bars showing confidence intervals
       - Saves to `detection_auroc.png`
    
    4. Implements `plot_task_performance()` method:
       - Plots task completion rates across models/conditions
       - Shows wasted actions comparison
       - Shows efficiency metrics
       - Saves to `task_performance.png`
    
    5. Implements `plot_ablation_curves()` method:
       - Plots ablation results (e.g., num_particles vs. performance)
       - Line plots showing how parameters affect metrics
       - Error bars for uncertainty
       - Saves to `ablation_curves.png`
    
    6. Implements `plot_intervention_quality()` method:
       - Plots intervention precision/recall across models
       - Shows over/under-correction rates
       - Saves to `intervention_quality.png`
    
    7. Uses matplotlib/seaborn for plotting
     - Publication-quality styling
     - Consistent color schemes
     - Clear labels and legends
     - Saves with high DPI (300) for publication
    
    Export `PlotGenerator` from `src/bsa/viz/__init__.py`.
    
    Ensure plots are deterministic (use seeds, consistent styling).
  </action>
  <verify>
    Run `python -c "from src.bsa.viz import PlotGenerator; print('Import OK')"` - should import successfully.
    Run `python -c "from src.bsa.viz.plots import PlotGenerator; import pandas as pd; df = pd.read_parquet('results/metrics/main_experiment/results.parquet'); plotter = PlotGenerator(df, 'results/figures'); print('PlotGenerator created')"` - should create plotter without errors.
  </verify>
  <done>PlotGenerator exists, can generate all required plot types</done>
</task>

<task type="auto">
  <name>Task 2: Implement generate_plots() function</name>
  <files>src/bsa/viz/plots.py</files>
  <action>
    Implement `generate_plots()` function that:
    
    1. Takes config dictionary (from `configs/analysis/plots.yaml`)
    2. Loads aggregated results (or uses provided DataFrame)
    3. Creates PlotGenerator instance
    4. Generates plots based on config:
       - Reads plot types from config.plots list
       - Calls appropriate plot methods
       - Saves to output directory
    5. Returns list of generated plot file paths
    
    This function is called by analysis pipeline.
    
    Ensure it handles config structure from `configs/analysis/plots.yaml`.
  </action>
  <verify>
    Run `python -c "from src.bsa.viz.plots import generate_plots; from src.bsa.common.config import load_config; from pathlib import Path; config = load_config(Path('configs/analysis/plots.yaml')); generate_plots(config, None)"` - should generate plots (may need aggregated results first).
  </verify>
  <done>generate_plots() function implemented, integrates with config</done>
</task>

<task type="auto">
  <name>Task 3: Update analysis config with plot specifications</name>
  <files>configs/analysis/plots.yaml</files>
  <action>
    Update `configs/analysis/plots.yaml` to include detailed plot specifications:
    
    1. Add plot configurations for each plot type:
       - Plot type, filename, title, labels
       - Data filters (which models/conditions to include)
       - Styling options (colors, figure size, DPI)
    
    2. Ensure config structure supports:
       - Multiple plot types
       - Customization options
       - Output directory specification
    
    This makes plots configurable and reproducible.
  </action>
  <verify>
    Run `python -c "import yaml; from pathlib import Path; config = yaml.safe_load(open('configs/analysis/plots.yaml')); print('Config valid:', list(config.keys()))"` - should load config without errors.
  </verify>
  <done>Analysis config updated with plot specifications</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] PlotGenerator can generate all required plot types
- [ ] Plots are publication-quality (clear labels, legends, styling)
- [ ] generate_plots() function works with config
- [ ] Plots saved correctly to results/figures/
- [ ] Config supports plot customization
</verification>

<success_criteria>

- PlotGenerator implemented with all plot types
- Plots are publication-quality and reproducible
- Config-driven plot generation works
- Ready for Plan 05-03 (Table generation)
  </success_criteria>

<output>
After completion, create `.planning/phases/05-metrics-analysis-report/05-02-SUMMARY.md`:

# Phase 5 Plan 2: Plotting Module Summary

**Implemented plotting module for generating visualizations**

## Accomplishments

- Created PlotGenerator class
- Implemented all required plot types (timeline, AUROC, task performance, ablation, intervention)
- Publication-quality styling
- Config-driven plot generation

## Files Created/Modified

- `src/bsa/viz/plots.py` - PlotGenerator class
- `src/bsa/viz/__init__.py` - Export PlotGenerator
- `configs/analysis/plots.yaml` - Updated with plot specifications

## Decisions Made

- Plotting library: matplotlib + seaborn
- Styling: Publication-quality (high DPI, clear labels, consistent colors)
- Plot types: Timeline, AUROC, task performance, ablation curves, intervention quality
- Config-driven: Plots specified in YAML config

## Issues Encountered

[Any issues with plotting, styling, config integration, etc.]

## Next Step

Ready for 05-03-PLAN.md (Table generation)
</output>
